<div class="pricing-card {{ ticket.status.group }} position-relative" data-ticket-id="{{ ticket.id }}">
    <!-- Подсветка (если нужна как в старом варианте) -->
    <div class="glow-wrapper {% if ticket_highlights.get(ticket.id) %}glowing{% endif %}"></div>

    <!-- Верхняя панель -->
    <div class="card-header">
        <span class="plan-type badge bg-{{ ticket.status.color or 'secondary' }}">
            {% set icon_map = {
                'success': 'check-circle',
                'primary': 'gear',
                'warning': 'plus-circle',
                'danger': 'exclamation-triangle',
                'info': 'key-fill'
            } %}
            <i class="bi bi-{{ icon_map.get(ticket.status.color, 'question-circle') }}"></i>
            {{ ticket.status.label }}
        </span>
        <span class="billing">#{{ ticket.id }}</span>
    </div>

    <!-- Основное содержимое -->
    <div class="card-body">
        <p class="trial">
            {% if ticket.source == 'talkme' %}TalkMe
            {% elif ticket.source == 'digiseller' %}Digiseller
            {% else %}{{ ticket.source or 'Не указан' }}{% endif %}
            • {{ ticket.messages|length }} сообщений
        </p>

        <ul class="features">
            {% if ticket.order_number %}
            <li>
                <i class="bi bi-receipt me-1"></i>
                <span class="d-inline-block text-truncate" style="max-width: 180px;">
                    {{ ticket.order_number }}
                </span>
            </li>
            {% endif %}
            {% if ticket.customer_email %}
            <li>
                <i class="bi bi-envelope me-1"></i>
                <span class="d-inline-block text-truncate" style="max-width: 180px;">
                    {{ ticket.customer_email }}
                </span>
            </li>
            {% endif %}
            <li>
                <i class="bi bi-info-circle me-1"></i>
                {{ ticket.reason or 'Описание отсутствует' }}
            </li>
        </ul>
    </div>

    <!-- Нижняя панель -->
    <div class="card-footer">
        <span class="price">
            {% if ticket.updated_at and ticket.updated_at != ticket.created_at %}
                {{ ticket.updated_at.strftime('%d/%m/%y') }}<br>
                {{ ticket.updated_at.strftime('%H:%M:%S') }}
            {% elif ticket.created_at %}
                {{ ticket.created_at.strftime('%d/%m/%y') }}
                {{ ticket.created_at.strftime('%H:%M:%S') }}
            {% endif %}
        </span>
        <div class="avatar-container position-relative" style="width: 38px; height: 38px;">
            <img src="{{ url_for('static', filename=ticket.author.avatar) if ticket.author.avatar else url_for('static', filename='img/default-avatar.png') }}"
                alt="{{ ticket.author.display_name or ticket.author.username }}"
                class="avatar-img {{ ticket.status.group }}">
        </div>
    </div>

    <!-- Ссылка на просмотр тикета -->
    <a href="{{ url_for('ticket.view_ticket', ticket_id=ticket.id) }}" class="stretched-link"></a>
</div>
